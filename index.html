<!DOCTYPE html><html><head><title>Learn how to get new call recording notification using Node JS- RingCentral Developer Tutorials</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" sizes="72x72" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" sizes="114x114" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/jquery-ui@1.12.1/themes/base/all.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div class="dpw-header-container"><div class="dpw-header center-section"><div class="logo"><a href="https://developers.ringcentral.com" class="logo-link"></a></div><div class="nav-top-menus"></div><div class="dpw-login-section"><a href="https://developer.ringcentral.com/login.html#/">Sign in | Sign up</a></div></div></div><div id="viewsaurus" data-title="Learn how to get new call recording notification using Node JS"><div class="saurus-panes"><div class="saurus-panes-header"><a href="https://ringcentral.github.io/tutorials/" class="saurus-back-to-tutorials">Tutorials</a><span>&gt;</span><span>Learn how to get new call recording notification using Node JS</span></div><div class="saurus-prose"><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw icon-menu"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn how to use the company presence event push notification to get notified for a new call recording. Click the &quot;Start Tutorial&quot; button below to start.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Call Recording Notification Tutorial" class="chapter"><div data-title="Welcome!" data-file="README.md" data-highlight="1-8" class="step"><h2 id="welcome-to-the-tutorial">Welcome to the tutorial</h2>
<p>This tutorial shows how to use RingCentral Company Presence Event Push Notification API to get notified when a new call recording is logged into a user call log database.</p>
<h3 id="requirements">Requirements</h3>
<p>You must have a RingCentral developer account. If you don&#39;t have one, click <a href="https://developer.ringcentral.com">here</a> to create a free developer account.</p>
<p>You also have to <a href="https://developer.ringcentral.com/library/getting-started.html">create a RingCentral app</a> with the &quot;ReadCallLog&quot; and &quot;ReadAccounts&quot; permissions. And retrieve your app ClientId and ClientSecret for using with this tutorial. Choose &quot;Server-only (No UI)&quot; for the app&#39;s platform type and &quot;Password flow&quot; for the Authorization flows.</p>
</div><div data-title="Project setup" data-file="README.md" class="step"><h2 id="clone-the-project-from-github">Clone the project from GitHub</h2>
<p>Run the commands shown on the right-hand side to clone the project from GitHub</p>
<p>Navigate to the folder and install the dependencies</p>
</div><div data-title="Set environment" data-file="dotenv" class="step"><h2 id="set-environment-parameters">Set environment parameters</h2>
<p>Rename the dotenv to .env and provide your app credentials, RingCentral sandbox account&#39;s username and password.</p>
<p><strong>Note</strong>: If you want to run the app on your production environment, make sure that your app is graduated and use the app production clientId and clientSecret. Also remember to change the MODE=production.</p>
</div><div data-title="Instantiate RingCentral SDK" data-file="index.js" data-highlight="6-22" class="step"><h2 id="instantiate-the-ringcentral-node-js-sdk">Instantiate the RingCentral Node JS SDK</h2>
<p>First, we create the SDK instance <code>rcsdk</code> and initialize it with the clientId and clientSecret.</p>
<p>Then we call the <code>rcsdk.platform()</code> function to get the platform instance. The <code>platform</code> instance will be used later to login and call RingCentral APIs.</p>
<p>We also call the <code>rcsdk.createSubscription()</code> function to create a <code>subscription</code> instance and implement a callback function &#39;presenceEvent&#39; to receive notification events.</p>
</div><div data-title="Login to RingCentral account" data-file="index.js" data-highlight="26-49" class="step"><h2 id="login-to-ringcentral-account">Login to RingCentral account</h2>
<p>To login RingCentral account, we call the <code>platform.login()</code> function with the given account&#39;s username and password.</p>
<p><strong>Note</strong>: In this application, we will use the push notification for company presence events. This means that we need to login with the main company username or with a user who has the admin role, so that we can receive push notification event for all users under the company account..</p>
</div><div data-title="Implement Notification Subscription" data-file="index.js" data-highlight="43" class="step"><h2 id="implement-notification-subscription">Implement notification subscription</h2>
<p>After logged in successfully, we are ready to subscribe for push notification so that we can receive company presence events.</p>
</div><div data-title="Create Notification Subscription" data-file="index.js" data-highlight="51-71" class="step"><h2 id="create-notification-subscription">Create notification subscription</h2>
<p>Before creating a new subscription for notification, we may need to detect if we have created one earlier. This step is necessary because the app could be terminated and rerun for any reason and we don&#39;t want to create multiple subscriptions.</p>
<p>When a push notification subscription is registered successfully, we will receive a response with the <strong>subscriptionId</strong>. We will save the <strong>subscriptionId</strong> locally (in this project we save it in the subscriptionId.txt file) so that we can use it to delete that subscription before creating a new one.</p>
<p>When we run the app for the first time, we don&#39;t have the <strong>subscriptionId</strong> (or the file does not exists), we will call the <code>subscribeForNotification()</code> function, where we will register for a new subscription.</p>
<p>When we rerun the app, we read the <strong>subscriptionId</strong> from the local file, then we will call the <code>removeRegisteredSubscription(id)</code> function with the subscription Id to delete that subscription before creating a new one.</p>
</div><div data-title="Subscribe for Notifications" data-file="index.js" data-highlight="73-90" class="step"><h2 id="subscribe-for-notifications">Subscribe for notifications</h2>
<p>RingCentral push notification supports multiple events notification. This means that we can subscribe for notifications of several different events such as when there is an incoming SMS, when a SMS message is deleted, when there is an incoming call etc. in a single subscription.</p>
<p>In this particular app, we are only interested at company presence events. Thus, we subscribe for just one event type of <code>presence</code>.</p>
<p>After registered successfully, we parse the response to get the subscription Id and save it to the local &quot;subscriptionId.txt&quot; file.</p>
<p>Now we are ready to receive company presence events.</p>
</div><div data-title="Receive Company Presence Events" data-file="index.js" data-highlight="92-98" class="step"><h2 id="capture-the-event-information">Capture the event information</h2>
<p>Whenever we receive a company presence event, we capture the <strong>extensionId</strong> and the <strong>telephonyStatus</strong> and create an empty <strong>startTime</strong> then add those parameters to a user object then call the <em>checkTelephonyStatusChange(user)</em> function, passing the <strong>user</strong> object along.</p>
</div><div data-title="Manage the users list" data-file="index.js" data-highlight="136-143" class="step"><h2 id="manage-the-list-of-users-under-the-company-account">Manage the list of users under the company account</h2>
<p>Inside the <em>checkTelephonyStatusChange(user)</em> function, we checked if the <strong>extensionId</strong> has been added to the <strong>usersList</strong>.</p>
<p>If the extension is not found from the list, we add the new <strong>user</strong> object to the <strong>usersList</strong>. We also check if the <strong>telephonyStatus</strong> is &#39;Ringing&#39; then we create a timestamp to specify the <strong>startTime</strong>.</p>
</div><div data-title="Telephony Status" data-file="index.js" data-highlight="100-144" class="step"><h2 id="detect-the-telephony-status-changed-sequences">Detect the telephony status changed sequences</h2>
<p>The Account Presence Event provides us with different user statuses. In this application, we are interested at only the <strong>telephonyStatus</strong> which has the following value:</p>
<p>&#39;NoCall&#39; | &#39;CallConnected&#39; | &#39;Ringing&#39; | &#39;OnHold&#39; | &#39;ParkedCall&#39;</p>
<p>When an extension (a user) under an account has no active call, its <strong>telephonyStatus</strong> is ‘NoCall’. When there is an incoming or outgoing call on an extension, the <strong>telephonyStatus</strong> is changed from ‘NoCall’ to ‘Ringing’.</p>
<p>Now, if the incoming/outgoing call is accepted, the <strong>telephonyStatus</strong> is again changed from ‘Ringing’ to ‘CallConnected’.</p>
<p>Then if the call is terminated, the <strong>telephonyStatus</strong> will be changed from ‘CallConnected’ to ‘NoCall’.</p>
</div><div data-title="Build the logics" data-file="index.js" data-highlight="102-134" class="step"><h2 id="build-the-logics">Build the logics</h2>
<p>First of all, we need to detect the time when the call started ringing. That is whenever the <strong>telephonyStatus</strong> is changed from &#39;NoCall&#39; to &#39;Ringing&#39;, we create the timestamp and keep it in the <strong>startTime</strong> in a user object. The <strong>startTime</strong> value will be used to define the time range when we read the user call logs.</p>
<p>Then we detect if the <strong>telephonyStatus</strong> is changed again from &#39;Ringing&#39; to &#39;CallConnected&#39; to define if the user is having an active call.</p>
<p>Finally, all we need is to wait for an active call terminates. That is when the <strong>telephonyStatus</strong> is changed from &#39;CallConnected&#39; to &#39;NoCall&#39;.</p>
<p>After the call is terminated, we create the timestamp for the <strong>stopTime</strong>, and we wait for about 20 seconds for the system to update the call log database, then proceed to read the call-log.</p>
</div><div data-title="Detect Call Recording" data-file="index.js" data-highlight="156-195" class="step"><h2 id="read-the-call-log">Read the call log</h2>
<p>We use the <strong>extensionId</strong> to create an endpoint for reading the call log of that particular extension.</p>
<p>We use the <strong>startTime</strong> for the <em>dateFrom</em> parameter and the <strong>stopTime</strong> for the <em>dateTo</em> parameter to fetch call log information within that period of time. It is the period of time between the call started ringing and the call is terminated.</p>
<p>We also set the query parameter <em>recordingType=&#39;All&#39;</em> to avoid reading the call log item without call recording.</p>
<h2 id="detect-call-recording">Detect call recording</h2>
<p>We parse the response and check the <em>records</em> array to find a <em>recording</em> object.</p>
<p>In this tutorial, if there is a new call recording, we will call the <em>saveAudioFile(record)</em> function to save the recording binary file to a local folder <em>recordings</em>. But it&#39;s up to you now to use the event of a new call recording for your real application.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="README.md" data-mode="markdown">IyBjYWxscmVjb3JkaW5nLW5vdGlmaWNhdGlvbi1ub2RlCkdldCBub3RpZmllZCB3aGVuIGEgbmV3IGNhbGwgd2l0aCBjYWxsIHJlY29yZGluZyBpcyBsb2dnZWQuCgojIyBDbG9uZSB0aGUgcHJvamVjdAoqIGdpdCBjbG9uZSBodHRwczovL2dpdGh1Yi5jb20vcmluZ2NlbnRyYWwtdHV0b3JpYWxzL2NhbGxyZWNvcmRpbmctbm90aWZpY2F0aW9uLW5vZGUKCiMjIEluc3RhbGwgZGVwZW5kZW5jaWVzCiogbnBtIGluc3RhbGwgLS1zYXZlCg==</textarea>
<textarea class="saurus-file" data-file="dotenv" data-mode="text">TU9ERT1zYW5kYm94CgpDTElFTlRfSURfU0I9WW91ckFwcF9TYW5kYm94X0NsaWVudElECkNMSUVOVF9TRUNSRVRfU0I9WW91ckFwcF9TYW5kYm94X0NsaWVudFNlY3JldAoKVVNFUk5BTUVfU0I9WW91clNhbmRib3hBY2NvdW50VXNlck5hbWUKUEFTU1dPUkRfU0I9WW91clNhbmRib3hBY2NvdW50UGFzc3dvcmQKCkNMSUVOVF9JRF9QUk9EPVlvdXJBcHBfUHJvZHVjdGlvbl9DbGllbnRJRApDTElFTlRfU0VDUkVUX1BST0Q9WW91ckFwcF9Qcm9kdWN0aW9uX0NsaWVudFNlY3JldAoKVVNFUk5BTUVfUFJPRD1Zb3VyUHJvZHVjdGlvbkFjY291bnRVc2VyTmFtZQpQQVNTV09SRF9QUk9EPVlvdXJQcm9kdWN0aW9uQWNjb3VudFBhc3N3b3JkCg==</textarea>
<textarea class="saurus-file" data-file="index.js" data-mode="javascript">dmFyIFJDID0gcmVxdWlyZSgncmluZ2NlbnRyYWwnKQp2YXIgZnMgPSByZXF1aXJlKCdmcycpCnJlcXVpcmUoJ2RvdGVudicpLmxvYWQoKQp2YXIgYXN5bmMgPSByZXF1aXJlKCJhc3luYyIpOwoKdmFyIHJjc2RrID0gbnVsbAppZiAocHJvY2Vzcy5lbnYuTU9ERSA9PSAicHJvZHVjdGlvbiIpewogIHJjc2RrID0gbmV3IFJDKHsKICAgIHNlcnZlcjpSQy5zZXJ2ZXIucHJvZHVjdGlvbiwKICAgIGFwcEtleTogcHJvY2Vzcy5lbnYuQ0xJRU5UX0lEX1BST0QsCiAgICBhcHBTZWNyZXQ6cHJvY2Vzcy5lbnYuQ0xJRU5UX1NFQ1JFVF9QUk9ECiAgfSkKfWVsc2V7CiAgcmNzZGsgPSBuZXcgUkMoewogICAgICBzZXJ2ZXI6UkMuc2VydmVyLnNhbmRib3gsCiAgICAgIGFwcEtleTogcHJvY2Vzcy5lbnYuQ0xJRU5UX0lEX1NCLAogICAgICBhcHBTZWNyZXQ6cHJvY2Vzcy5lbnYuQ0xJRU5UX1NFQ1JFVF9TQgogICAgfSkKfQp2YXIgcGxhdGZvcm0gPSByY3Nkay5wbGF0Zm9ybSgpCnZhciBzdWJzY3JpcHRpb24gPSByY3Nkay5jcmVhdGVTdWJzY3JpcHRpb24oKQpzdWJzY3JpcHRpb24ub24oc3Vic2NyaXB0aW9uLmV2ZW50cy5ub3RpZmljYXRpb24sIHByZXNlbmNlRXZlbnQpCgp2YXIgdXNlcnNMaXN0ID0gW10KCmxvZ2luKCkKCmZ1bmN0aW9uIGxvZ2luKCl7CiAgdmFyIHVuID0gIiIKICB2YXIgcHdkID0gIiIKICBpZiAocHJvY2Vzcy5lbnYuTU9ERSA9PSAicHJvZHVjdGlvbiIpewogICAgdW49IHByb2Nlc3MuZW52LlVTRVJOQU1FX1BST0QsCiAgICBwd2Q9IHByb2Nlc3MuZW52LlBBU1NXT1JEX1BST0QKICB9ZWxzZXsKICAgIHVuPSBwcm9jZXNzLmVudi5VU0VSTkFNRV9TQiwKICAgIHB3ZD0gcHJvY2Vzcy5lbnYuUEFTU1dPUkRfU0IKICB9CiAgcGxhdGZvcm0ubG9naW4oewogICAgdXNlcm5hbWU6dW4sCiAgICBwYXNzd29yZDpwd2QKICB9KQogIC50aGVuKGZ1bmN0aW9uKHJlc3ApewogICAgY2hlY2tFeGlzdGluZ1N1YnNjcmlwdGlvbigpCiAgfSkKICAuY2F0Y2goZnVuY3Rpb24oZSl7CiAgICBjb25zb2xlLmxvZyhlKQogICAgdGhyb3cgZQogIH0pCn0KCmZ1bmN0aW9uIGNoZWNrRXhpc3RpbmdTdWJzY3JpcHRpb24oKXsKICBmcy5yZWFkRmlsZSgnc3Vic2NyaXB0aW9uSWQudHh0JywgJ3V0ZjgnLCBmdW5jdGlvbiAoZXJyLCBpZCkgewogICAgaWYgKGVycikgewogICAgICBzdWJzY3JpYmVGb3JOb3RpZmljYXRpb24oKQogICAgfWVsc2V7CiAgICAgIHJlbW92ZVJlZ2lzdGVyZWRTdWJzY3JpcHRpb24oaWQpCiAgICB9CiAgfSk7Cn0KCmZ1bmN0aW9uIHJlbW92ZVJlZ2lzdGVyZWRTdWJzY3JpcHRpb24oaWQpIHsKICBwbGF0Zm9ybS5kZWxldGUoJy9zdWJzY3JpcHRpb24vJyArIGlkKQogICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgIGNvbnNvbGUubG9nKCJkZWxldGVkOiAiICsgaWQpCiAgICAgIHN1YnNjcmliZUZvck5vdGlmaWNhdGlvbigpCiAgICB9KQogICAgLmNhdGNoKGZ1bmN0aW9uKGUpIHsKICAgICAgY29uc29sZS5lcnJvcihlLnRvU3RyaW5nKCkpOwogICAgICBzdWJzY3JpYmVGb3JOb3RpZmljYXRpb24oKQogICAgfSk7Cn0KCmZ1bmN0aW9uIHN1YnNjcmliZUZvck5vdGlmaWNhdGlvbigpewogIHZhciBldmVudEZpbHRlciA9IFsnL3Jlc3RhcGkvdjEuMC9hY2NvdW50L34vcHJlc2VuY2UnXQogIHN1YnNjcmlwdGlvbi5zZXRFdmVudEZpbHRlcnMoZXZlbnRGaWx0ZXIpCiAgIC5yZWdpc3RlcigpCiAgIC50aGVuKGZ1bmN0aW9uKHJlc3ApewogICAgIGNvbnNvbGUubG9nKCdSZWFkeSBmb3IgZ2V0dGluZyBhY2NvdW50IHByZXNlbnNlIGV2ZW50cycpCiAgICAgdmFyIGpzb24gPSByZXNwLmpzb24oKTsKICAgICBmcy53cml0ZUZpbGUoInN1YnNjcmlwdGlvbklkLnR4dCIsIGpzb24uaWQsIGZ1bmN0aW9uKGVycikgewogICAgIGlmKGVycikKICAgICAgIGNvbnNvbGUubG9nKGVycik7CiAgICAgZWxzZQogICAgICAgY29uc29sZS5sb2coIlN1YnNjcmlwdGlvbklkICIgKyBqc29uLmlkICsgIiBpcyBzYXZlZC4iKTsKICAgICB9KTsKICAgfSkKICAgLmNhdGNoKGZ1bmN0aW9uKGUpewogICAgIHRocm93IGUKICAgfSkKfQoKZnVuY3Rpb24gcHJlc2VuY2VFdmVudChtc2cpewogIHZhciB1c2VyID0ge30KICB1c2VyWydleHRlbnNpb25JZCddID0gbXNnLmJvZHkuZXh0ZW5zaW9uSWQKICB1c2VyWyd0ZWxlcGhvbnlTdGF0dXMnXSA9IG1zZy5ib2R5LnRlbGVwaG9ueVN0YXR1cwogIHVzZXJbJ3N0YXJ0VGltZSddID0gIiIKICBjaGVja1RlbGVwaG9ueVN0YXR1c0NoYW5nZSh1c2VyKQp9CgpmdW5jdGlvbiBjaGVja1RlbGVwaG9ueVN0YXR1c0NoYW5nZSh1c2VyKXsKICB2YXIgbmV3VXNlciA9IHRydWUKICBmb3IgKHZhciBpPTA7IGk8dXNlcnNMaXN0Lmxlbmd0aDsgaSsrKXsKICAgIGlmICh1c2Vyc0xpc3RbaV0uZXh0ZW5zaW9uSWQgPT0gdXNlci5leHRlbnNpb25JZCl7CiAgICAgIGNvbnNvbGUubG9nKCJPTEQgLT4gTkVXOiAiICsgdXNlcnNMaXN0W2ldLnRlbGVwaG9ueVN0YXR1cyArICIgLT4gIiArIHVzZXIudGVsZXBob255U3RhdHVzKQogICAgICBuZXdVc2VyID0gZmFsc2UKICAgICAgaWYgKHVzZXJzTGlzdFtpXS50ZWxlcGhvbnlTdGF0dXMgPT0gIk5vQ2FsbCIgJiYgdXNlci50ZWxlcGhvbnlTdGF0dXMgPT0gIlJpbmdpbmciKXsKICAgICAgICB1c2Vyc0xpc3RbaV0udGVsZXBob255U3RhdHVzID0gdXNlci50ZWxlcGhvbnlTdGF0dXMKICAgICAgICB1c2Vyc0xpc3RbaV0uc3RhcnRUaW1lID0gY3JlYXRlU3RhcnRUaW1lKCkKICAgICAgICBjb25zb2xlLmxvZygiRXh0ZW5zaW9uSWQgIiArIHVzZXJzTGlzdFtpXS5leHRlbnNpb25JZCArICIgaGFzIGFuIGluY29taW5nIGNhbGwiKQogICAgICAgIGJyZWFrCiAgICAgIH0KICAgICAgaWYgKHVzZXJzTGlzdFtpXS50ZWxlcGhvbnlTdGF0dXMgPT0gIlJpbmdpbmciICYmIHVzZXIudGVsZXBob255U3RhdHVzID09ICJDYWxsQ29ubmVjdGVkIil7CiAgICAgICAgdXNlcnNMaXN0W2ldLnRlbGVwaG9ueVN0YXR1cyA9IHVzZXIudGVsZXBob255U3RhdHVzCiAgICAgICAgY29uc29sZS5sb2coIkV4dGVuc2lvbklkICIgKyB1c2Vyc0xpc3RbaV0uZXh0ZW5zaW9uSWQgKyAiIGhhcyBhIGFjY2VwdGVkIGEgY2FsbCIpCiAgICAgICAgYnJlYWsKICAgICAgfQogICAgICBpZiAodXNlcnNMaXN0W2ldLnRlbGVwaG9ueVN0YXR1cyA9PSAiUmluZ2luZyIgJiYgdXNlci50ZWxlcGhvbnlTdGF0dXMgPT0gIk5vQ2FsbCIpewogICAgICAgIHVzZXJzTGlzdFtpXS50ZWxlcGhvbnlTdGF0dXMgPSB1c2VyLnRlbGVwaG9ueVN0YXR1cwogICAgICAgIGNvbnNvbGUubG9nKCJFeHRlbnNpb25JZCAiICsgdXNlcnNMaXN0W2ldLmV4dGVuc2lvbklkICsgIiBoYXMgYSBtaXNzZWQgY2FsbCIpCiAgICAgICAgYnJlYWsKICAgICAgfQogICAgICBpZiAodXNlcnNMaXN0W2ldLnRlbGVwaG9ueVN0YXR1cyA9PSAiQ2FsbENvbm5lY3RlZCIgJiYgdXNlci50ZWxlcGhvbnlTdGF0dXMgPT0gIk5vQ2FsbCIpewogICAgICAgIHVzZXJzTGlzdFtpXS50ZWxlcGhvbnlTdGF0dXMgPSB1c2VyLnRlbGVwaG9ueVN0YXR1cwogICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKQogICAgICAgIHZhciBzdG9wVGltZSA9IGRhdGUudG9JU09TdHJpbmcoKQogICAgICAgIHN0b3BUaW1lID0gc3RvcFRpbWUucmVwbGFjZSgnLycsICc6JykKICAgICAgICBjb25zb2xlLmxvZygiRXh0ZW5zaW9uSWQgIiArIHVzZXJzTGlzdFtpXS5leHRlbnNpb25JZCArICIgaGFzIGEgdGVybWluYXRlZCBjYWxsIikKICAgICAgICAvLyB3YWl0IGZvciAyMCBzZWNzIHRoZW4gY2hlY2sgZm9yIGNhbGwgcmVjb3JkaW5ncwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsKICAgICAgICAgIHJlYWRFeHRlbnNpb25DYWxsTG9ncyh1c2Vyc0xpc3RbaV0uZXh0ZW5zaW9uSWQsIHVzZXJzTGlzdFtpXS5zdGFydFRpbWUsIHN0b3BUaW1lKQogICAgICAgIH0sIDIwMDAwKQogICAgICAgIGJyZWFrCiAgICAgIH0KICAgIH0KICB9CiAgaWYgKG5ld1VzZXIpewogICAgY29uc29sZS5sb2coIk5FVyBVU0VSOiAiICsgIiAtPiAiICsgdXNlci50ZWxlcGhvbnlTdGF0dXMpCiAgICBpZiAodXNlci50ZWxlcGhvbnlTdGF0dXMgPT0gIlJpbmdpbmciKXsKICAgICAgdXNlci5zdGFydFRpbWUgPSBjcmVhdGVTdGFydFRpbWUoKQogICAgICBjb25zb2xlLmxvZygiRXh0ZW5zaW9uSWQgIiArIHVzZXIuZXh0ZW5zaW9uSWQgKyAiIGhhcyBhbiBpbmNvbWluZyBjYWxsIikKICAgIH0KICAgIHVzZXJzTGlzdC5wdXNoKHVzZXIpCiAgfQp9CgpmdW5jdGlvbiBjcmVhdGVTdGFydFRpbWUoKXsKICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCkKICB2YXIgdGltZSA9IGRhdGUuZ2V0VGltZSgpCiAgLy8gbWFrZSAxMCBzZWNzIHRvIG9mZnNldCBzb21lIGRlbGF5IGluIHJlc3BvbnNlCiAgdmFyIGxlc3NYWFNlY29uZHMgPSB0aW1lIC0gMTAwMDAKICB2YXIgZnJvbSA9IG5ldyBEYXRlKGxlc3NYWFNlY29uZHMpCiAgdmFyIGRhdGVGcm9tID0gZnJvbS50b0lTT1N0cmluZygpCiAgcmV0dXJuIGRhdGVGcm9tLnJlcGxhY2UoJy8nLCAnOicpCn0KCmZ1bmN0aW9uIHJlYWRFeHRlbnNpb25DYWxsTG9ncyhleHRlbnNpb25JZCwgc3RhcnRUaW1lLCBzdG9wVGltZSl7CiAgdmFyIGVuZHBvaW50ID0gJy9hY2NvdW50L34vZXh0ZW5zaW9uLycrIGV4dGVuc2lvbklkICsnL2NhbGwtbG9nJwogIHZhciBwYXJhbXMgPSB7fQogIHBhcmFtc1snZGF0ZUZyb20nXSA9IHN0YXJ0VGltZQogIHBhcmFtc1snZGF0ZVRvJ10gPSBzdG9wVGltZQogIHBhcmFtc1sncmVjb3JkaW5nVHlwZSddID0gJ0FsbCcKCiAgcGxhdGZvcm0uZ2V0KGVuZHBvaW50LCBwYXJhbXMpCiAgLnRoZW4oZnVuY3Rpb24ocmVzcCl7CiAgICBhc3luYy5lYWNoKHJlc3AuanNvbigpLnJlY29yZHMsCiAgICAgIGZ1bmN0aW9uKHJlY29yZCwgY2FsbGJhY2spewogICAgICAgIGNvbnNvbGUubG9nKCJUSElTIENBTEwgSEFTIEEgUkVDT1JESU5HOiAiICsgcmVjb3JkLnJlY29yZGluZy5jb250ZW50VXJpKQogICAgICAgIHNhdmVBdWRpb0ZpbGUocmVjb3JkKQogICAgICB9LAogICAgICBmdW5jdGlvbihlcnIpewogICAgICAgIGNvbnNvbGUubG9nKCJObyBjYWxsIHdpdGggY2FsbCByZWNvcmRpbmcgd2l0aGluIHRoaXMgcGVyaW9kIG9mIHRpbWUuIikKICAgICAgfQogICAgKTsKICB9KQogIC5jYXRjaChmdW5jdGlvbihlKXsKICAgIHZhciBlcnIgPSBlLnRvU3RyaW5nKCk7CiAgICBjb25zb2xlLmxvZyhlcnIpCiAgfSkKfQoKCmZ1bmN0aW9uIHNhdmVBdWRpb0ZpbGUocmVjb3JkKXsKICBwbGF0Zm9ybS5nZXQocmVjb3JkLnJlY29yZGluZy5jb250ZW50VXJpKQogIC50aGVuKGZ1bmN0aW9uKHJlcykgewogICAgcmV0dXJuIHJlcy5yZXNwb25zZSgpLmJ1ZmZlcigpOwogIH0pCiAgLnRoZW4oZnVuY3Rpb24oYnVmZmVyKSB7CiAgICB2YXIgZGVzdEZpbGUgPSAnLi9yZWNvcmRpbmdzLycgKyByZWNvcmQucmVjb3JkaW5nLmlkICsgJy5tcDMnCiAgICBmcy53cml0ZUZpbGVTeW5jKGRlc3RGaWxlLCBidWZmZXIpOwogICAgY29uc29sZS5sb2coIkNBTEwgUkVDT1JESU5HIFNBVkVEIEFUOiAiICsgZGVzdEZpbGUpCiAgfSkKICAuY2F0Y2goZnVuY3Rpb24oZSl7CiAgICBjb25zb2xlLmxvZyhlKQogIH0pCn0K</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><div class="saurus-file-actions"><a href="https://github.com/ringcentral-tutorials/callrecording-notification-node" target="_blank" class="explorer-get-code"><i class="fa fa-lg fa-github-square"></i>View Code on GitHub</a><a href="https://github.com/ringcentral-tutorials/callrecording-notification-node/archive/master.zip" target="_blank" class="explorer-get-code"><i class="fa fa-lg icon-download"></i>Download Source Code</a></div></div></div></div><footer><div class="footer-content"><div class="footer-content-row layout-2-cols"><div class="footer-content-row-left"><div class="footer-logo"><a href="http://www.ringcentral.com"><span>Back to the main site</span></a></div></div><div class="footer-content-row-right"><ul class="footer-text-links"><li><a href="http://www.ringcentral.com/legal.html" target="_blank"><span>Legal</span></a></li><li><a href="http://www.ringcentral.com/security-statement.html" target="_blank"><span>Security Policy</span></a></li><li><a href="http://www.ringcentral.com/legal/privacy-policy.html" target="_blank"><span>Privacy Policy</span></a></li><li><a ng-href="https://devcommunity.ringcentral.com" target="_blank" href="https://devcommunity.ringcentral.com"><span>Community</span></a></li><li><a href="https://medium.com/ringcentral-developers" target="_blank"><span>Blog</span></a></li></ul></div></div><div class="footer-content-row footer-content-row-last layout-2-cols"><div class="footer-content-row-left"><span class="footer-copyright">© 1999-<span ng-bind="::main.nowObj|date:'yyyy'" class="footer-copyright-to ng-binding">2017</span> RingCentral, Inc. All rights reserved.</span></div><div class="footer-content-row-right"><div class="footer-image-links"><div class="footer-image-link footer-image-link-facebook"><a target="_blank" href="http://www.facebook.com/ringcentral"><i class="fa icon-facebook"></i></a></div><div class="footer-image-link footer-image-link-twitter"><a target="_blank" href="http://twitter.com/ringcentraldevs"><i class="fa icon-twitter"></i></a></div><div class="footer-image-link footer-image-link-google-plus"><a target="_blank" href="https://www.google.com/+ringcentral"><i class="fa icon-google_plus"></i></a></div><div class="footer-image-link footer-image-link-linkedin"><a target="_blank" href="http://www.linkedin.com/company/ringcentral"><i class="fa icon-linkedin"></i></a></div><div class="footer-image-link footer-image-link-youtube"><a target="_blank" href="http://www.youtube.com/ringcentral"><i class="fa icon-youtube"></i></a></div></div></div></div></div></footer></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script><script>window.tutorialName="Learn how to get new call recording notification using Node JS";</script><script src="viewsaurus.js"></script></body></html>